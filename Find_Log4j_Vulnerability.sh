#!/bin/bash

NONE='\033[00m'
RED='\033[01;31m'
GREEN='\033[01;32m'

dt=`date +%d%m%Y-%H%M%S`
tempfile="/tmp/tempreadfile_log4j_${dt}.txt"

if [ -n "${1}" ]; then
script_home="${1}"
else
script_home=`pwd`
fi

jarfile=`find ${script_home} -type f -name "*.jar"`

for i in ${jarfile}
do
findclass=`jar tvf "${i}" |grep -i JndiLookup.class`
if [ -n "${findclass}" ]; then
echo -e "${GREEN}++++++++++++below file searched which might be posibility of vulnerable log4j file++++++++${NONE}\n"
echo -e "${GREEN}file find:- ${findclass} ${NONE}\n"
echo -e "${GREEN}inside jar:- ${i} ${NONE}\n"
echo -e "${GREEN}++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++${NONE}\n"
echo -e "\n\n"
fi
findlog4jcore=`echo "${findclass}" | egrep -i "log4j|core"`
if [ -n "${findlog4jcore}" ]; then
echo "vulnerable log4j file:- ${i} and it has class inside:- ${findclass}" >>"${tempfile}"
echo -e "\n" >>"${tempfile}"
fi
done

if [ -f "${tempfile}" ]; then
tempfileread=`cat ${tempfile}`
echo -e "${RED}##################below is the vulnerable log4j file which needs to be fixed############################${NONE}\n"
echo -e "${RED} ${tempfileread} ${NONE}"
echo -e "${RED}########################################################################################################${NONE}\n"
rm "${tempfile}"
fi
